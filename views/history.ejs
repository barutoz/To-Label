<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/To-Label.png" />
    <title>To-Label</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <nav
      class="navbar bg-dark border-bottom border-bottom-dark navbar-expand-lg fixed-top"
      style="font-size: 30px; font-weight: bold; width: 100%"
      data-bs-theme="dark"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="/" style="font-size: 30px">To-Label</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarTogglerDemo02"
          aria-controls="navbarTogglerDemo02"
          aria-expanded="false"
          aria-label="Toggle navigation"
          style="text-align: right"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/history">History</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/setting">Setting</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/logout">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main style="position: absolute; top: 80px; right: 30px; left: 30px">
      <div class="mt-4 border-bottom border-success border-3 text-success"><h3><%= username %>さんのレッテル履歴</h3></div>
      <div class="mt-4">
      <% if (exists){ %> 
      <% if(list.length == 1){ %>
        <div class="card mb-4 rounded-1">
          <div class="border-start border-5 rounded-1 h-100" name="border">
            <div class="card-header">
              <div class="row">
                <div class="col-12 col-md-6"><p class="mb-0"><%= list[0][0]["time"] %></p></div>
                <div class="col-12 col-md-6"><p class="mb-0">ルーム<%= list[0][0]["room_number"] %></p></div>
              </div>
            </div>
            <div class="card-body">   
              <table class="table table-striped" style="text-align: center;">
                <thead>
                  <tr>
                    <th scope="col">誰から?</th>
                    <th scope="col">レッテル</th>
                  </tr>
                </thead>
                <tbody class="table-group-divider">
                <% for(i=0; i<list[0].length; i++) { %>
                  <tr class="table-<%= list[0][i]["color"] %>">
                    <td style="width: 30%;"><%= list[0][i]["from_username"] %></td>
                    <td style="width: 70%;"><%= list[0][i]["msg"] %></td>
                  </tr>
                  <% }; %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
          <% }else{ %>
          <% for(let x=0; x<list.length; x++){ %> 
          <% if(x==list.length-1){ %> 
            <% if(x%2 == 0){ %>
              <div class="row">
              <div class="col-12 col-md-6">
                <div class="card mb-4 rounded-1">
                  <div class="border-start border-5 rounded-1 h-100" name="border">
                    <div class="card-header">
                      <div class="row">
                        <div class="col-12 col-md-6"><p class="mb-0"><%= list[x][0]["time"] %></p></div>
                        <div class="col-12 col-md-6"><p class="mb-0">ルーム<%= list[x][0]["room_number"] %></p></div>
                      </div>
                    </div>
                    <div class="card-body">   
                      <table class="table table-striped" style="text-align: center;">
                        <thead>
                          <tr>
                            <th scope="col">誰から?</th>
                            <th scope="col">レッテル</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                        <% for(i=0; i<list[x].length; i++) { %>
                          <tr class="table-<%= list[x][i]["color"] %>">
                            <td style="width: 30%;"><%= list[x][i]["from_username"] %></td>
                            <td style="width: 70%;"><%= list[x][i]["msg"] %></td>
                          </tr>
                          <% }; %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div></div>
            <%}else{%>
              <div class="col-12 col-md-6">
                <div class="card mb-4 rounded-1">
                  <div class="border-start border-5 rounded-1 h-100" name="border">
                    <div class="card-header">
                      <div class="row">
                        <div class="col-12 col-md-6"><p class="mb-0"><%= list[x][0]["time"] %></p></div>
                        <div class="col-12 col-md-6"><p class="mb-0">ルーム<%= list[x][0]["room_number"] %></p></div>
                      </div>
                    </div>
                    <div class="card-body">   
                      <table class="table table-striped" style="text-align: center;">
                        <thead>
                          <tr>
                            <th scope="col">誰から?</th>
                            <th scope="col">レッテル</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                        <% for(i=0; i<list[x].length; i++) { %>
                          <tr class="table-<%= list[x][i]["color"] %>">
                            <td style="width: 30%;"><%= list[x][i]["from_username"] %></td>
                            <td style="width: 70%;"><%= list[x][i]["msg"] %></td>
                          </tr>
                          <% }; %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div></div>
              <% } %>
          <% }else{ %> 
            <% if(x%2 == 0){ %>
              <div class="row">
              <div class="col-12 col-md-6">
                <div class="card mb-4 rounded-1">
                  <div class="border-start border-5 rounded-1 h-100" name="border">
                    <div class="card-header">
                      <div class="row">
                        <div class="col-12 col-md-6"><p class="mb-0"><%= list[x][0]["time"] %></p></div>
                        <div class="col-12 col-md-6"><p class="mb-0">ルーム<%= list[x][0]["room_number"] %></p></div>
                      </div>
                    </div>
                    <div class="card-body">   
                      <table class="table table-striped" style="text-align: center;">
                        <thead>
                          <tr>
                            <th scope="col">誰から?</th>
                            <th scope="col">レッテル</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                        <% for(i=0; i<list[x].length; i++) { %>
                          <tr class="table-<%= list[x][i]["color"] %>">
                            <td style="width: 30%;"><%= list[x][i]["from_username"] %></td>
                            <td style="width: 70%;"><%= list[x][i]["msg"] %></td>
                          </tr>
                          <% }; %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            <%}else{%>
              <div class="col-12 col-md-6">
                <div class="card mb-4 rounded-1">
                  <div class="border-start border-5 rounded-1 h-100" name="border">
                    <div class="card-header">
                      <div class="row">
                        <div class="col-12 col-md-6"><p class="mb-0"><%= list[x][0]["time"] %></p></div>
                        <div class="col-12 col-md-6"><p class="mb-0">ルーム<%= list[x][0]["room_number"] %></p></div>
                      </div>
                    </div>
                    <div class="card-body">   
                      <table class="table table-striped" style="text-align: center;">
                        <thead>
                          <tr>
                            <th scope="col">誰から?</th>
                            <th scope="col">レッテル</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                        <% for(i=0; i<list[x].length; i++) { %>
                          <tr class="table-<%= list[x][i]["color"] %>">
                            <td style="width: 30%;"><%= list[x][i]["from_username"] %></td>
                            <td style="width: 70%;"><%= list[x][i]["msg"] %></td>
                          </tr>
                          <% }; %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div></div>
              <% } %>
          <% } %>
            <% } %>
          <% }; %>
          <% }else{ %>
            <div>
          <h3>あなたには、まだレッテルが貼られてません。ゲームに参加しよう!</h3>
          </div>
          <% } %>
    </main>
  </body>
  <script>
    const color=["primary","danger","warning","success","info"]
    $(window).on("load",function(){
      $("div[name='border']").each(function(){
        var randomIndex = Math.floor(Math.random() * color.length);
        $(this).addClass("border-"+color[randomIndex]);
        $(this).find(".card-header").addClass("border-"+color[randomIndex]);
        $(this).find(".card-header").addClass("text-"+color[randomIndex]+"-emphasis");
        $(this).find(".card-header").addClass("bg-"+color[randomIndex]+"-subtle");
        $(this).parent().addClass("text-"+color[randomIndex]+"-emphasis");
        $(this).parent().addClass("border-"+color[randomIndex]);
        $(this).find("tbody").addClass("border-"+color[randomIndex]);
      })
    })
  </script>
</html>
